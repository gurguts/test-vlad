(()=>{"use strict";var e,t,r={1963:(e,t,r)=>{var o=r(5072),a=r.n(o),n=r(7825),d=r.n(n),l=r(7659),i=r.n(l),s=r(5056),c=r.n(s),m=r(540),u=r.n(m),p=r(1113),h=r.n(p),y=r(2378),g={};g.styleTagTransform=h(),g.setAttributes=c(),g.insert=i().bind(null,"head"),g.domAPI=d(),g.insertStyleElement=u(),a()(y.A,g),y.A&&y.A.locals&&y.A.locals;var w=r(7541),f={};f.styleTagTransform=h(),f.setAttributes=c(),f.insert=i().bind(null,"head"),f.domAPI=d(),f.insertStyleElement=u(),a()(w.A,f),w.A&&w.A.locals&&w.A.locals;const v=document.getElementById("gameCanvas"),b=v.getContext("2d"),E=document.getElementById("connectWalletScreen"),k=document.getElementById("connectWalletButton"),x=document.getElementById("startScreen"),S=document.getElementById("startButton"),I=document.getElementById("leaderboardButton"),M=document.getElementById("gameOver"),T=document.getElementById("scoreDisplay"),A=document.getElementById("restartButton"),B=document.getElementById("submitScoreButton"),C=(document.getElementById("gameOverLeaderboardButton"),document.getElementById("leaderboardModal"),document.getElementById("leaderboardBody")),L=document.getElementById("closeLeaderboardButton"),Y=document.getElementById("myRecordButton"),O=document.getElementById("gameOverMyRecordButton"),P=v.height/2,F={doodler:{x:v.width/2-25,y:v.height-100,width:40,height:50,velocityY:0,velocityX:0,jumpStrength:-15,gravity:.5,facingRight:!0},platforms:[],cameraY:0,score:0,speedMultiplier:1,gameOver:!1,gameStarted:!1,lastTime:performance.now(),isConnected:!1,walletAddress:""};function N(){if(b.clearRect(0,0,v.width,v.height),se.background.complete&&F.gameStarted){const e=se.background.height,t=-F.cameraY%e;b.drawImage(se.background,0,t,v.width,e),t>-e&&b.drawImage(se.background,0,t-e,v.width,e)}if(!F.gameStarted)return;F.platforms.forEach(e=>{if(!e.broken){let t;switch(e.type){case"normal":t=se.platform;break;case"moving":t=se.movingPlatform;break;case"breakable":t=se.breakablePlatform;break;case"spring":t=se.springPlatform}b.drawImage(t,e.x,e.y-F.cameraY,e.width,e.height)}}),b.save();const e=F.doodler.width/2;F.doodler.x<-e?F.doodler.x+=v.width:F.doodler.x+F.doodler.width>v.width+e&&(F.doodler.x-=v.width),F.doodler.facingRight?(b.drawImage(se.doodler,F.doodler.x,F.doodler.y-F.cameraY,F.doodler.width,F.doodler.height),F.doodler.x<0?(b.restore(),b.save(),b.drawImage(se.doodler,F.doodler.x+v.width,F.doodler.y-F.cameraY,F.doodler.width,F.doodler.height)):F.doodler.x+F.doodler.width>v.width&&(b.restore(),b.save(),b.drawImage(se.doodler,F.doodler.x-v.width,F.doodler.y-F.cameraY,F.doodler.width,F.doodler.height))):(b.translate(F.doodler.x+F.doodler.width,0),b.scale(-1,1),b.drawImage(se.doodler,0,F.doodler.y-F.cameraY,F.doodler.width,F.doodler.height),F.doodler.x<0?(b.restore(),b.save(),b.translate(F.doodler.x+F.doodler.width+v.width,0),b.scale(-1,1),b.drawImage(se.doodler,0,F.doodler.y-F.cameraY,F.doodler.width,F.doodler.height)):F.doodler.x+F.doodler.width>v.width&&(b.restore(),b.save(),b.translate(F.doodler.x+F.doodler.width-v.width,0),b.scale(-1,1),b.drawImage(se.doodler,0,F.doodler.y-F.cameraY,F.doodler.width,F.doodler.height))),b.restore(),b.fillStyle="black",b.font="20px Arial",b.fillText(`Score: ${F.score}`,10,20)}function j(){const e=Math.random();return e<.5?"normal":e<.7?"moving":e<.9?"breakable":"spring"}function R(){F.doodler.x=v.width/2-25,F.doodler.y=v.height-100,F.doodler.velocityY=0,F.doodler.velocityX=0,F.doodler.facingRight=!0,F.cameraY=0,F.score=0,F.speedMultiplier=1,F.gameOver=!1,F.gameStarted=!0,M.style.display="none",function(){F.platforms.length=0,F.platforms.push({x:160,y:v.height-50,width:80,height:20,type:"normal"});for(let e=1;e<6;e++){const t=F.platforms[e-1],r=Math.random()*(v.width-80),o=t.y-(50+100*Math.random()),a=j();F.platforms.push({x:r,y:o,width:80,height:20,type:a,velocityX:"moving"===a?2*F.speedMultiplier:0,broken:!1})}}(),F.lastTime=performance.now(),X(performance.now())}function X(e){if(!F.gameOver&&F.gameStarted){const t=(e-F.lastTime)/1e3;F.lastTime=e,function(e){F.speedMultiplier=Math.min(1+Math.abs(F.score)/1e4,2),F.doodler.velocityY+=F.doodler.gravity*F.speedMultiplier*e*60,F.doodler.y+=F.doodler.velocityY*e*60,F.doodler.x+=F.doodler.velocityX*e*60;const t=F.doodler.y-F.cameraY;if(Math.abs(t-P)>10){const t=F.doodler.y-P;F.cameraY+=.1*(t-F.cameraY)*e*60}F.score=-1*Math.floor(F.cameraY/10),F.platforms.forEach(t=>{"moving"===t.type&&(t.x+=t.velocityX*e*60,t.velocityX=2*(t.velocityX>=0?1:-1)*F.speedMultiplier,(t.x<0||t.x+t.width>v.width)&&(t.velocityX=-t.velocityX))});let r=[];F.platforms.forEach((e,t)=>{F.doodler.x<e.x+e.width&&F.doodler.x+F.doodler.width>e.x&&F.doodler.y+F.doodler.height>e.y&&F.doodler.y+F.doodler.height<e.y+e.height&&F.doodler.velocityY>0&&!e.broken&&("spring"===e.type?F.doodler.velocityY=1.5*F.doodler.jumpStrength*F.speedMultiplier:F.doodler.velocityY=F.doodler.jumpStrength*F.speedMultiplier,"breakable"===e.type&&(e.broken=!0,r.push(t)))}),F.platforms=F.platforms.filter((e,t)=>!r.includes(t));const o=F.platforms.reduce((e,t)=>t.y<e.y?t:e,F.platforms[0]);if(o.y>F.cameraY-150){const e=Math.random()*(v.width-80),t=o.y-(50+100*Math.random()),r=j();F.platforms.push({x:e,y:t,width:80,height:20,type:r,velocityX:"moving"===r?2*F.speedMultiplier:0,broken:!1}),F.platforms=F.platforms.filter(e=>e.y<F.cameraY+v.height+100)}F.doodler.y>F.cameraY+v.height&&(F.gameOver=!0,F.gameStarted=!1,M.style.display="block",T.textContent=`Score: ${F.score}`)}(t),N(),requestAnimationFrame(X)}}var $=r(4676),_=r(3197),U=r(5387),q=r(9873),D=r(8946),W=r(2427);const z=(0,$.x)({id:50312,name:"Somnia Testnet",nativeCurrency:{decimals:18,name:"Ether",symbol:"STT"},rpcUrls:{default:{http:["https://dream-rpc.somnia.network"]}},blockExplorers:{default:{name:"Explorer",url:"shannon-explorer.somnia.network"}}}),H=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"player",type:"address"},{indexed:!1,internalType:"uint256",name:"score",type:"uint256"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"ScoreRegistered",type:"event"},{inputs:[],name:"getAllScores",outputs:[{components:[{internalType:"address",name:"player",type:"address"},{internalType:"uint256",name:"score",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],internalType:"struct SomniaJump.Score[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getPlayerCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_player",type:"address"}],name:"getScore",outputs:[{components:[{internalType:"address",name:"player",type:"address"},{internalType:"uint256",name:"score",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],internalType:"struct SomniaJump.Score",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"players",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_score",type:"uint256"}],name:"registerScore",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"scores",outputs:[{internalType:"address",name:"player",type:"address"},{internalType:"uint256",name:"score",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"}],J="0xB828843Bbf31AC871C31386DA821F1E945C14072";async function G(){if(!F.isConnected)throw new Error("Wallet not connected");try{const e=(0,D.l)({chain:z,transport:(0,W.L)(z.rpcUrls.default.http[0])}),t=(await e.readContract({address:J,abi:H,functionName:"getAllScores"})).sort((e,t)=>Number(t.score)-Number(e.score));C.innerHTML="",t.forEach((e,t)=>{const r=document.createElement("tr");r.innerHTML=`\n        <td>${t+1}</td>\n        <td>${e.player.slice(0,6)}...${e.player.slice(-4)}</td>\n        <td>${e.score}</td>\n        <td>${new Date(1e3*Number(e.timestamp)).toLocaleString()}</td>\n      `,C.appendChild(r)})}catch(e){throw console.error("Failed to fetch leaderboard:",e),new Error("Failed to fetch leaderboard: "+e.message)}}async function K(e){if(!F.isConnected)throw new Error("Wallet not connected");if(!(0,q.P)(e))throw new Error("Invalid address");try{const t=(0,D.l)({chain:z,transport:(0,W.L)(z.rpcUrls.default.http[0])});return await t.readContract({address:J,abi:H,functionName:"getScore",args:[e]})}catch(e){throw console.error("Failed to fetch player score:",e),new Error("Failed to fetch player score: "+e.message)}}const Q=r.p+"assets/doodler.png",V=r.p+"assets/platform.png",Z=r.p+"assets/moving_platform.png",ee=r.p+"assets/breakable_platform.png",te=r.p+"assets/spring_platform.png",re=r.p+"assets/background.png",oe=new Image;oe.src=Q;const ae=new Image;ae.src=V;const ne=new Image;ne.src=Z;const de=new Image;de.src=ee;const le=new Image;le.src=te;const ie=new Image;ie.src=re;const se={doodler:oe,platform:ae,movingPlatform:ne,breakablePlatform:de,springPlatform:le,background:ie};!function(e){let t=0;const r=Object.keys(se).length;for(const o of Object.values(se))o.complete?(t++,t===r&&e()):o.onload=()=>{t++,t===r&&e()}}(function(){E.style.display="block",N(),document.addEventListener("keydown",e=>{F.gameStarted&&("ArrowLeft"===e.code&&(F.doodler.velocityX=-5,F.doodler.facingRight=!1),"ArrowRight"===e.code&&(F.doodler.velocityX=5,F.doodler.facingRight=!0))}),document.addEventListener("keyup",e=>{F.gameStarted&&("ArrowLeft"!==e.code&&"ArrowRight"!==e.code||(F.doodler.velocityX=0))}),k.addEventListener("click",async()=>{try{await async function(){if("undefined"==typeof window||!window.ethereum)throw console.error("MetaMask is not installed!"),alert("Please install MetaMask to play the game."),new Error("MetaMask not installed");try{await window.ethereum.request({method:"eth_requestAccounts"});const e=(0,_.F)({chain:z,transport:(0,U.I)(window.ethereum)}),[t]=await e.getAddresses();if(!(0,q.P)(t))throw new Error("Invalid wallet address");F.walletAddress=t,F.isConnected=!0,console.log("Connected account:",t);const r=await window.ethereum.request({method:"eth_chainId"});if(parseInt(r,16)!==z.id)try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${z.id.toString(16)}`}]})}catch(e){if(4902!==e.code)throw e;await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${z.id.toString(16)}`,chainName:z.name,rpcUrls:z.rpcUrls.default.http,nativeCurrency:z.nativeCurrency,blockExplorerUrls:[z.blockExplorers.default.url]}]})}}catch(e){throw console.error("User denied account access:",e),e}}(),F.isConnected&&(E.style.display="none",x.style.display="block")}catch(e){console.error("Failed to connect MetaMask:",e),alert("Failed to connect MetaMask. Please try again.")}}),S.addEventListener("click",()=>{x.style.display="none",F.gameStarted=!0,R()}),I.addEventListener("click",async()=>{await G(),leaderboardModal.style.display="flex"}),A.addEventListener("click",()=>{M.style.display="none",F.gameStarted=!0,R()}),B.addEventListener("click",async()=>{try{await async function(e){if(!F.isConnected||!F.walletAddress)throw new Error("Wallet not connected");if(!(0,q.P)(F.walletAddress))throw new Error("Invalid wallet address");if(e<=0)throw new Error("Score must be greater than zero");try{const t=(0,_.F)({chain:z,transport:(0,U.I)(window.ethereum)}),r=(0,D.l)({chain:z,transport:(0,W.L)(z.rpcUrls.default.http[0])}),o=await t.writeContract({address:J,abi:H,functionName:"registerScore",args:[BigInt(e)],account:F.walletAddress});let a;console.log("Transaction sent, hash:",o);try{a=await r.waitForTransactionReceipt({hash:o,timeout:12e4}),console.log("Score submitted, tx hash:",o)}catch(t){console.warn("Transaction confirmation timed out, checking contract state...");const a=await r.readContract({address:J,abi:H,functionName:"getScore",args:[F.walletAddress]});if(Number(a.score)===e)return console.log("Score verified in contract, tx likely successful:",o),{transactionHash:o,status:"success"};throw new Error("Score not updated in contract, transaction may have failed")}return a}catch(e){if(console.error("Failed to submit score:",e),e.message.includes("New score must be higher"))throw new Error("New score must be higher than your previous score");if(e.message.includes("Score must be greater than zero"))throw new Error("Score must be greater than zero");if(e.message.includes("IntegerOutOfRangeError"))throw new Error("Invalid score value");throw new Error("Failed to submit score: "+e.message)}}(F.score),alert("Score submitted successfully!")}catch(e){console.error("Failed to submit score:",e),alert("Failed to submit score. Please try again.")}}),Y.addEventListener("click",async()=>{try{const e=await K(F.walletAddress),t=e.score.toString(),r=new Date(1e3*Number(e.timestamp)).toLocaleString();alert(`Your best score: ${t}\nDate: ${r}`)}catch(e){console.error("Failed to fetch your score:",e),alert("Failed to fetch your score. Please try again.")}}),O.addEventListener("click",async()=>{try{const e=await K(F.walletAddress),t=e.score.toString(),r=new Date(1e3*Number(e.timestamp)).toLocaleString();alert(`Your best score: ${t}\nDate: ${r}`)}catch(e){console.error("Failed to fetch your score:",e),alert("Failed to fetch your score. Please try again.")}}),gameOverLeaderboardButton.addEventListener("click",async()=>{await G(),leaderboardModal.style.display="flex"}),L.addEventListener("click",()=>{leaderboardModal.style.display="none"})})},2378:(e,t,r)=>{r.d(t,{A:()=>l});var o=r(1601),a=r.n(o),n=r(6314),d=r.n(n)()(a());d.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=d},7541:(e,t,r)=>{r.d(t,{A:()=>l});var o=r(1601),a=r.n(o),n=r(6314),d=r.n(n)()(a());d.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=d}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={id:e,exports:{}};return r[e](n,n.exports,a),n.exports}a.m=r,e=[],a.O=(t,r,o,n)=>{if(!r){var d=1/0;for(c=0;c<e.length;c++){for(var[r,o,n]=e[c],l=!0,i=0;i<r.length;i++)(!1&n||d>=n)&&Object.keys(a.O).every(e=>a.O[e](r[i]))?r.splice(i--,1):(l=!1,n<d&&(d=n));if(l){e.splice(c--,1);var s=o();void 0!==s&&(t=s)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[r,o,n]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,r)=>(a.f[r](e,t),t),[])),a.u=e=>"js/"+e+".e78e47de2664a92947fe.js",a.miniCssF=e=>{},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},a.l=(e,r,o,n)=>{if(t[e])t[e].push(r);else{var d,l;if(void 0!==o)for(var i=document.getElementsByTagName("script"),s=0;s<i.length;s++){var c=i[s];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==" :"+o){d=c;break}}d||(l=!0,(d=document.createElement("script")).charset="utf-8",d.timeout=120,a.nc&&d.setAttribute("nonce",a.nc),d.setAttribute("data-webpack"," :"+o),d.src=e),t[e]=[r];var m=(r,o)=>{d.onerror=d.onload=null,clearTimeout(u);var a=t[e];if(delete t[e],d.parentNode&&d.parentNode.removeChild(d),a&&a.forEach(e=>e(o)),r)return r(o)},u=setTimeout(m.bind(null,void 0,{type:"timeout",target:d}),12e4);d.onerror=m.bind(null,d.onerror),d.onload=m.bind(null,d.onload),l&&document.head.appendChild(d)}},a.p="/test-vlad/",(()=>{var e={524:0};a.f.j=(t,r)=>{var o=a.o(e,t)?e[t]:void 0;if(0!==o)if(o)r.push(o[2]);else{var n=new Promise((r,a)=>o=e[t]=[r,a]);r.push(o[2]=n);var d=a.p+a.u(t),l=new Error;a.l(d,r=>{if(a.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var n=r&&("load"===r.type?"missing":r.type),d=r&&r.target&&r.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+d+")",l.name="ChunkLoadError",l.type=n,l.request=d,o[1](l)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,r)=>{var o,n,[d,l,i]=r,s=0;if(d.some(t=>0!==e[t])){for(o in l)a.o(l,o)&&(a.m[o]=l[o]);if(i)var c=i(a)}for(t&&t(r);s<d.length;s++)n=d[s],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},r=self.webpackChunk_=self.webpackChunk_||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),a.nc=void 0;var n=a.O(void 0,[591],()=>a(1963));n=a.O(n)})();