(()=>{"use strict";var e,t,r={1963:(e,t,r)=>{var o=r(5072),a=r.n(o),n=r(7825),d=r.n(n),l=r(7659),i=r.n(l),s=r(5056),c=r.n(s),m=r(540),p=r.n(m),u=r(1113),h=r.n(u),y=r(2378),g={};g.styleTagTransform=h(),g.setAttributes=c(),g.insert=i().bind(null,"head"),g.domAPI=d(),g.insertStyleElement=p(),a()(y.A,g),y.A&&y.A.locals&&y.A.locals;var w=r(7541),f={};f.styleTagTransform=h(),f.setAttributes=c(),f.insert=i().bind(null,"head"),f.domAPI=d(),f.insertStyleElement=p(),a()(w.A,f),w.A&&w.A.locals&&w.A.locals;const v=document.getElementById("gameCanvas"),b=v.getContext("2d"),x=document.getElementById("connectWalletScreen"),k=document.getElementById("connectWalletButton"),E=document.getElementById("startScreen"),M=document.getElementById("startButton"),I=document.getElementById("leaderboardButton"),S=document.getElementById("gameOver"),T=document.getElementById("scoreDisplay"),A=document.getElementById("restartButton"),B=document.getElementById("submitScoreButton"),C=(document.getElementById("gameOverLeaderboardButton"),document.getElementById("leaderboardModal"),document.getElementById("leaderboardBody")),Y=document.getElementById("closeLeaderboardButton"),L=v.height/2,O={doodler:{x:v.width/2-25,y:v.height-100,width:40,height:50,velocityY:0,velocityX:0,jumpStrength:-15,gravity:.5,facingRight:!0},platforms:[],cameraY:0,score:0,speedMultiplier:1,gameOver:!1,gameStarted:!1,lastTime:performance.now(),isConnected:!1,walletAddress:""};function P(){if(b.clearRect(0,0,v.width,v.height),de.background.complete&&O.gameStarted){const e=de.background.height,t=-O.cameraY%e;b.drawImage(de.background,0,t,v.width,e),t>-e&&b.drawImage(de.background,0,t-e,v.width,e)}if(!O.gameStarted)return;O.platforms.forEach(e=>{if(!e.broken){let t;switch(e.type){case"normal":t=de.platform;break;case"moving":t=de.movingPlatform;break;case"breakable":t=de.breakablePlatform;break;case"spring":t=de.springPlatform}b.drawImage(t,e.x,e.y-O.cameraY,e.width,e.height)}}),b.save();const e=O.doodler.width/2;O.doodler.x<-e?O.doodler.x+=v.width:O.doodler.x+O.doodler.width>v.width+e&&(O.doodler.x-=v.width),O.doodler.facingRight?(b.drawImage(de.doodler,O.doodler.x,O.doodler.y-O.cameraY,O.doodler.width,O.doodler.height),O.doodler.x<0?(b.restore(),b.save(),b.drawImage(de.doodler,O.doodler.x+v.width,O.doodler.y-O.cameraY,O.doodler.width,O.doodler.height)):O.doodler.x+O.doodler.width>v.width&&(b.restore(),b.save(),b.drawImage(de.doodler,O.doodler.x-v.width,O.doodler.y-O.cameraY,O.doodler.width,O.doodler.height))):(b.translate(O.doodler.x+O.doodler.width,0),b.scale(-1,1),b.drawImage(de.doodler,0,O.doodler.y-O.cameraY,O.doodler.width,O.doodler.height),O.doodler.x<0?(b.restore(),b.save(),b.translate(O.doodler.x+O.doodler.width+v.width,0),b.scale(-1,1),b.drawImage(de.doodler,0,O.doodler.y-O.cameraY,O.doodler.width,O.doodler.height)):O.doodler.x+O.doodler.width>v.width&&(b.restore(),b.save(),b.translate(O.doodler.x+O.doodler.width-v.width,0),b.scale(-1,1),b.drawImage(de.doodler,0,O.doodler.y-O.cameraY,O.doodler.width,O.doodler.height))),b.restore(),b.fillStyle="black",b.font="20px Arial",b.fillText(`Score: ${O.score}`,10,20)}function F(){const e=Math.random();return e<.5?"normal":e<.7?"moving":e<.9?"breakable":"spring"}function j(){O.doodler.x=v.width/2-25,O.doodler.y=v.height-100,O.doodler.velocityY=0,O.doodler.velocityX=0,O.doodler.facingRight=!0,O.cameraY=0,O.score=0,O.speedMultiplier=1,O.gameOver=!1,O.gameStarted=!0,S.style.display="none",function(){O.platforms.length=0,O.platforms.push({x:160,y:v.height-50,width:80,height:20,type:"normal"});for(let e=1;e<6;e++){const t=O.platforms[e-1],r=Math.random()*(v.width-80),o=t.y-(50+100*Math.random()),a=F();O.platforms.push({x:r,y:o,width:80,height:20,type:a,velocityX:"moving"===a?2*O.speedMultiplier:0,broken:!1})}}(),O.lastTime=performance.now(),X(performance.now())}function X(e){if(!O.gameOver&&O.gameStarted){const t=(e-O.lastTime)/1e3;O.lastTime=e,function(e){O.speedMultiplier=Math.min(1+Math.abs(O.score)/1e4,2),O.doodler.velocityY+=O.doodler.gravity*O.speedMultiplier*e*60,O.doodler.y+=O.doodler.velocityY*e*60,O.doodler.x+=O.doodler.velocityX*e*60;const t=O.doodler.y-O.cameraY;if(Math.abs(t-L)>10){const t=O.doodler.y-L;O.cameraY+=.1*(t-O.cameraY)*e*60}O.score=-1*Math.floor(O.cameraY/10),O.platforms.forEach(t=>{"moving"===t.type&&(t.x+=t.velocityX*e*60,t.velocityX=2*(t.velocityX>=0?1:-1)*O.speedMultiplier,(t.x<0||t.x+t.width>v.width)&&(t.velocityX=-t.velocityX))});let r=[];O.platforms.forEach((e,t)=>{O.doodler.x<e.x+e.width&&O.doodler.x+O.doodler.width>e.x&&O.doodler.y+O.doodler.height>e.y&&O.doodler.y+O.doodler.height<e.y+e.height&&O.doodler.velocityY>0&&!e.broken&&("spring"===e.type?O.doodler.velocityY=1.5*O.doodler.jumpStrength*O.speedMultiplier:O.doodler.velocityY=O.doodler.jumpStrength*O.speedMultiplier,"breakable"===e.type&&(e.broken=!0,r.push(t)))}),O.platforms=O.platforms.filter((e,t)=>!r.includes(t));const o=O.platforms.reduce((e,t)=>t.y<e.y?t:e,O.platforms[0]);if(o.y>O.cameraY-150){const e=Math.random()*(v.width-80),t=o.y-(50+100*Math.random()),r=F();O.platforms.push({x:e,y:t,width:80,height:20,type:r,velocityX:"moving"===r?2*O.speedMultiplier:0,broken:!1}),O.platforms=O.platforms.filter(e=>e.y<O.cameraY+v.height+100)}O.doodler.y>O.cameraY+v.height&&(O.gameOver=!0,O.gameStarted=!1,S.style.display="block",T.textContent=`Score: ${O.score}`)}(t),P(),requestAnimationFrame(X)}}var _=r(4676),N=r(3197),R=r(5387),$=r(9873),q=r(8946),U=r(2427);const W=(0,_.x)({id:50312,name:"Somnia Testnet",nativeCurrency:{decimals:18,name:"Ether",symbol:"STT"},rpcUrls:{default:{http:["https://dream-rpc.somnia.network"]}},blockExplorers:{default:{name:"Explorer",url:"https://somnia-devnet.socialscan.io"}}}),D=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"player",type:"address"},{indexed:!1,internalType:"uint256",name:"score",type:"uint256"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"ScoreRegistered",type:"event"},{inputs:[],name:"getAllScores",outputs:[{components:[{internalType:"address",name:"player",type:"address"},{internalType:"uint256",name:"score",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],internalType:"struct SomniaJump.Score[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getPlayerCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_player",type:"address"}],name:"getScore",outputs:[{components:[{internalType:"address",name:"player",type:"address"},{internalType:"uint256",name:"score",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],internalType:"struct SomniaJump.Score",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"players",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_score",type:"uint256"}],name:"registerScore",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"scores",outputs:[{internalType:"address",name:"player",type:"address"},{internalType:"uint256",name:"score",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"}],z="0xB828843Bbf31AC871C31386DA821F1E945C14072";async function H(){if(!O.isConnected)throw new Error("Wallet not connected");try{const e=(0,q.l)({chain:W,transport:(0,U.L)(W.rpcUrls.default.http[0])}),t=(await e.readContract({address:z,abi:D,functionName:"getAllScores"})).sort((e,t)=>Number(t.score)-Number(e.score));C.innerHTML="",t.forEach((e,t)=>{const r=document.createElement("tr");r.innerHTML=`\n        <td>${t+1}</td>\n        <td>${e.player.slice(0,6)}...${e.player.slice(-4)}</td>\n        <td>${e.score}</td>\n        <td>${new Date(1e3*Number(e.timestamp)).toLocaleString()}</td>\n      `,C.appendChild(r)})}catch(e){throw console.error("Failed to fetch leaderboard:",e),new Error("Failed to fetch leaderboard: "+e.message)}}const J=r.p+"assets/doodler.png",G=r.p+"assets/platform.png",K=r.p+"assets/moving_platform.png",Q=r.p+"assets/breakable_platform.png",V=r.p+"assets/spring_platform.png",Z=r.p+"assets/background.png",ee=new Image;ee.src=J;const te=new Image;te.src=G;const re=new Image;re.src=K;const oe=new Image;oe.src=Q;const ae=new Image;ae.src=V;const ne=new Image;ne.src=Z;const de={doodler:ee,platform:te,movingPlatform:re,breakablePlatform:oe,springPlatform:ae,background:ne};!function(e){let t=0;const r=Object.keys(de).length;for(const o of Object.values(de))o.complete?(t++,t===r&&e()):o.onload=()=>{t++,t===r&&e()}}(function(){x.style.display="block",P(),document.addEventListener("keydown",e=>{O.gameStarted&&("ArrowLeft"===e.code&&(O.doodler.velocityX=-5,O.doodler.facingRight=!1),"ArrowRight"===e.code&&(O.doodler.velocityX=5,O.doodler.facingRight=!0))}),document.addEventListener("keyup",e=>{O.gameStarted&&("ArrowLeft"!==e.code&&"ArrowRight"!==e.code||(O.doodler.velocityX=0))}),k.addEventListener("click",async()=>{try{await async function(){if("undefined"==typeof window||!window.ethereum)throw console.error("MetaMask is not installed!"),alert("Please install MetaMask to play the game."),new Error("MetaMask not installed");try{await window.ethereum.request({method:"eth_requestAccounts"});const e=(0,N.F)({chain:W,transport:(0,R.I)(window.ethereum)}),[t]=await e.getAddresses();if(!(0,$.P)(t))throw new Error("Invalid wallet address");O.walletAddress=t,O.isConnected=!0,console.log("Connected account:",t);const r=await window.ethereum.request({method:"eth_chainId"});if(parseInt(r,16)!==W.id)try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${W.id.toString(16)}`}]})}catch(e){if(4902!==e.code)throw e;await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${W.id.toString(16)}`,chainName:W.name,rpcUrls:W.rpcUrls.default.http,nativeCurrency:W.nativeCurrency,blockExplorerUrls:[W.blockExplorers.default.url]}]})}}catch(e){throw console.error("User denied account access:",e),e}}(),O.isConnected&&(x.style.display="none",E.style.display="block")}catch(e){console.error("Failed to connect MetaMask:",e),alert("Failed to connect MetaMask. Please try again.")}}),M.addEventListener("click",()=>{E.style.display="none",O.gameStarted=!0,j()}),I.addEventListener("click",async()=>{await H(),leaderboardModal.style.display="flex"}),A.addEventListener("click",()=>{S.style.display="none",O.gameStarted=!0,j()}),B.addEventListener("click",async()=>{try{await async function(e){if(!O.isConnected||!O.walletAddress)throw new Error("Wallet not connected");if(!(0,$.P)(O.walletAddress))throw new Error("Invalid wallet address");try{const t=(0,N.F)({chain:W,transport:(0,R.I)(window.ethereum)}),r=await t.writeContract({address:z,abi:D,functionName:"registerScore",args:[BigInt(e)],account:O.walletAddress}),o=(0,q.l)({chain:W,transport:(0,U.L)(W.rpcUrls.default.http[0])}),a=await o.waitForTransactionReceipt({hash:r});return console.log("Score submitted, tx hash:",r),a}catch(e){if(console.error("Failed to submit score:",e),e.message.includes("New score must be higher"))throw new Error("New score must be higher than your previous score");if(e.message.includes("Score must be greater than zero"))throw new Error("Score must be greater than zero");throw new Error("Failed to submit score: "+e.message)}}(O.score),alert("Score submitted successfully!")}catch(e){console.error("Failed to submit score:",e),alert("Failed to submit score. Please try again.")}}),gameOverLeaderboardButton.addEventListener("click",async()=>{await H(),leaderboardModal.style.display="flex"}),Y.addEventListener("click",()=>{leaderboardModal.style.display="none"})})},2378:(e,t,r)=>{r.d(t,{A:()=>l});var o=r(1601),a=r.n(o),n=r(6314),d=r.n(n)()(a());d.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=d},7541:(e,t,r)=>{r.d(t,{A:()=>l});var o=r(1601),a=r.n(o),n=r(6314),d=r.n(n)()(a());d.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=d}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={id:e,exports:{}};return r[e](n,n.exports,a),n.exports}a.m=r,e=[],a.O=(t,r,o,n)=>{if(!r){var d=1/0;for(c=0;c<e.length;c++){for(var[r,o,n]=e[c],l=!0,i=0;i<r.length;i++)(!1&n||d>=n)&&Object.keys(a.O).every(e=>a.O[e](r[i]))?r.splice(i--,1):(l=!1,n<d&&(d=n));if(l){e.splice(c--,1);var s=o();void 0!==s&&(t=s)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[r,o,n]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,r)=>(a.f[r](e,t),t),[])),a.u=e=>"js/"+e+".e78e47de2664a92947fe.js",a.miniCssF=e=>{},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},a.l=(e,r,o,n)=>{if(t[e])t[e].push(r);else{var d,l;if(void 0!==o)for(var i=document.getElementsByTagName("script"),s=0;s<i.length;s++){var c=i[s];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==" :"+o){d=c;break}}d||(l=!0,(d=document.createElement("script")).charset="utf-8",d.timeout=120,a.nc&&d.setAttribute("nonce",a.nc),d.setAttribute("data-webpack"," :"+o),d.src=e),t[e]=[r];var m=(r,o)=>{d.onerror=d.onload=null,clearTimeout(p);var a=t[e];if(delete t[e],d.parentNode&&d.parentNode.removeChild(d),a&&a.forEach(e=>e(o)),r)return r(o)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:d}),12e4);d.onerror=m.bind(null,d.onerror),d.onload=m.bind(null,d.onload),l&&document.head.appendChild(d)}},a.p="/test-vlad/",(()=>{var e={524:0};a.f.j=(t,r)=>{var o=a.o(e,t)?e[t]:void 0;if(0!==o)if(o)r.push(o[2]);else{var n=new Promise((r,a)=>o=e[t]=[r,a]);r.push(o[2]=n);var d=a.p+a.u(t),l=new Error;a.l(d,r=>{if(a.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var n=r&&("load"===r.type?"missing":r.type),d=r&&r.target&&r.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+d+")",l.name="ChunkLoadError",l.type=n,l.request=d,o[1](l)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,r)=>{var o,n,[d,l,i]=r,s=0;if(d.some(t=>0!==e[t])){for(o in l)a.o(l,o)&&(a.m[o]=l[o]);if(i)var c=i(a)}for(t&&t(r);s<d.length;s++)n=d[s],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},r=self.webpackChunk_=self.webpackChunk_||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),a.nc=void 0;var n=a.O(void 0,[591],()=>a(1963));n=a.O(n)})();