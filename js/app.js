(()=>{const t=document.getElementById("gameCanvas"),e=t.getContext("2d"),i=new Image;i.src="/img/player.png";const h=new Image;h.src="/img/bullet.png";const a=new Image;a.src="/img/enemy1.png";const l=new Image;l.src="/img/enemy2.png";const o=new Image;o.src="/img/enemy3.png";const n=new Image;n.src="/img/bonus.png";const d=new Image;function s(t){const e=new Audio(t);e.volume="/audio/shoot.mp3"===t?.05:"/audio/explosion.mp3"===t?.1:.5,e.play().catch((()=>{}))}d.src="/img/background.png";const r={x:t.width/2-25,y:t.height-50,width:50,height:50,speed:300,lastShot:0,shootDelay:1/3.3,bonusCount:0,tiltAngle:0},g=[],p=[],m=[],w=[];let y=0,c=1,x=100,u="start";const f=document.getElementById("startButton"),A=document.getElementById("restartButton");let M=performance.now(),b=0,S=3,v=null,P=0,I=!1,R={};document.addEventListener("keydown",(t=>R[t.code]=!0)),document.addEventListener("keyup",(t=>R[t.code]=!1)),f.onclick=()=>{"start"===u&&(u="playing",f.style.display="none",A.style.display="none",M=performance.now(),v={wave:1,time:0,duration:2},s("/audio/wave.mp3"),requestAnimationFrame($))},A.onclick=()=>{"gameOver"===u&&(r.x=t.width/2-25,r.lastShot=0,r.shootDelay=1/3.3,r.bonusCount=0,r.tiltAngle=0,g.length=0,p.length=0,m.length=0,w.length=0,y=0,c=1,x=100,b=0,S=3,P=0,u="playing",I=!1,f.style.display="none",A.style.display="none",v={wave:1,time:0,duration:2},s("/audio/wave.mp3"),M=performance.now(),requestAnimationFrame($))};const k=[{width:30,height:30,speed:50,points:10,image:a,health:1},{width:40,height:40,speed:60,points:20,image:l,health:1},{width:60,height:60,speed:30,points:50,image:o,health:3}];function C(t){return t<=3?k[0]:t<=6?Math.random()<.6?k[1]:k[0]:Math.random()<.3?k[2]:Math.random()<.6?k[1]:k[0]}const E={straight:(t,e)=>{t.y+=t.speed*e},sine:(e,i)=>{e.y+=e.speed*i,e.x=e.startX+50*Math.sin(e.y/50),e.x<0&&(e.x=0),e.x>t.width-e.width&&(e.x=t.width-e.width)},spiral:(e,i)=>{e.y+=e.speed*i,e.spiralAngle=(e.spiralAngle||0)+2*i,e.x=e.startX+30*Math.cos(e.spiralAngle),e.x<0&&(e.x=0),e.x>t.width-e.width&&(e.x=t.width-e.width)}};function $(a){"playing"===u&&(f.style.display="none",A.style.display="none");const l=Math.min((a-M)/1e3,.1);if(P+=50*l,P>=t.height&&(P-=t.height),e.clearRect(0,0,t.width,t.height),d.complete?(e.drawImage(d,0,P,t.width,t.height),e.drawImage(d,0,P-t.height,t.width,t.height)):(e.fillStyle="black",e.fillRect(0,0,t.width,t.height)),"start"===u)return f.style.display="block",A.style.display="none",e.fillStyle="white",e.font="40px Arial",e.textAlign="center",e.fillText("Space Shooter",t.width/2,t.height/2-50),e.font="20px Arial",e.fillText("Click Start to Play",t.width/2,t.height/2),M=a,void requestAnimationFrame($);if("gameOver"===u)return I||(s("/audio/gameover.mp3"),I=!0),f.style.display="none",A.style.display="block",e.fillStyle="white",e.font="40px Arial",e.textAlign="center",e.fillText("Game Over",t.width/2,t.height/2),e.font="20px Arial",e.fillText(`Score: ${y} | Wave: ${c}`,t.width/2,t.height/2+50),void(M=a);M=a,R.ArrowLeft||R.KeyA?(r.tiltAngle=Math.max(r.tiltAngle-2*l,-Math.PI/6),r.x-=r.speed*l,r.x<0&&(r.x=0)):R.ArrowRight||R.KeyD?(r.tiltAngle=Math.min(r.tiltAngle+2*l,Math.PI/6),r.x+=r.speed*l,r.x>t.width-r.width&&(r.x=t.width-r.width)):r.tiltAngle*=.9,R.Space&&a/1e3>r.lastShot+r.shootDelay&&(g.push({x:r.x+r.width/2-5,y:r.y-10,width:10,height:20,speed:400}),s("/audio/shoot.mp3"),r.lastShot=a/1e3);for(let t=g.length-1;t>=0;t--)g[t].y-=g[t].speed*l,g[t].y<-g[t].height&&g.splice(t,1);for(let e=p.length-1;e>=0;e--){const i=p[e];E[i.pattern](i,l),i.y>t.height&&(u="gameOver")}for(let e=m.length-1;e>=0;e--)m[e].y+=m[e].speed*l,m[e].blinkPhase=(m[e].blinkPhase||0)+4*l*Math.PI,m[e].y>t.height&&m.splice(e,1);for(let t=w.length-1;t>=0;t--){const e=w[t];e.time+=l,"explosion"===e.type&&e.particles.forEach((t=>{t.x+=t.vx*l,t.y+=t.vy*l,t.alpha-=l/e.duration})),e.time>e.duration&&w.splice(t,1)}if(v&&(v.time+=l,v.time>v.duration&&(v=null)),a/1e3-b>S){0===p.length&&y>=x&&!v&&(c++,x=100*c,S=Math.max(1,3-.05*c),v={wave:c,time:0,duration:2},s("/audio/wave.mp3"),b=a/1e3);const e=Math.floor(c/2)+1,i=c%3==0?"line":c%4==0?"triangle":"random";if("line"===i){const i=t.width/(e+1);for(let t=0;t<e;t++){const e=C(c);p.push({x:i*(t+1)-e.width/2,y:0,startX:i*(t+1)-e.width/2,width:e.width,height:e.height,speed:e.speed*(1+.1*c),points:e.points,image:e.image,health:e.health,maxHealth:e.health,pattern:["straight","sine","spiral"][Math.floor(3*Math.random())]})}}else if("triangle"===i){const i=t.width/2,h=0,a=C(c);p.push({x:i-a.width/2,y:h,startX:i-a.width/2,width:a.width,height:a.height,speed:a.speed*(1+.1*c),points:a.points,image:a.image,health:a.health,maxHealth:a.health,pattern:["straight","sine","spiral"][Math.floor(3*Math.random())]}),e>=3&&(p.push({x:i-100-a.width/2,y:h+50,startX:i-100-a.width/2,width:a.width,height:a.height,speed:a.speed*(1+.1*c),points:a.points,image:a.image,health:a.health,maxHealth:a.health,pattern:["straight","sine","spiral"][Math.floor(3*Math.random())]}),p.push({x:i+100-a.width/2,y:h+50,startX:i+100-a.width/2,width:a.width,height:a.height,speed:a.speed*(1+.1*c),points:a.points,image:a.image,health:a.health,maxHealth:a.health,pattern:["straight","sine","spiral"][Math.floor(3*Math.random())]}))}else for(let i=0;i<e;i++){const e=C(c);p.push({x:Math.random()*(t.width-e.width),y:0,startX:Math.random()*(t.width-e.width),width:e.width,height:e.height,speed:e.speed*(1+.1*c),points:e.points,image:e.image,health:e.health,maxHealth:e.health,pattern:["straight","sine","spiral"][Math.floor(3*Math.random())]})}b=a/1e3}for(let t=g.length-1;t>=0;t--)for(let e=p.length-1;e>=0;e--){const i=g[t],h=p[e];if(i.x<h.x+h.width&&i.x+i.width>h.x&&i.y<h.y+h.height&&i.y+i.height>h.y){if(g.splice(t,1),h.health--,h.health<=0){p.splice(e,1),y+=h.points;const t=[];for(let e=0;e<10;e++)t.push({x:h.x+h.width/2,y:h.y+h.height/2,vx:200*(Math.random()-.5),vy:200*(Math.random()-.5),radius:2+3*Math.random(),alpha:1});w.push({type:"explosion",x:h.x+h.width/2,y:h.y+h.height/2,radius:10,maxRadius:h.width,time:0,duration:.5,particles:t}),s("/audio/explosion.mp3"),Math.random()<.15&&m.push({x:h.x+h.width/2-10,y:h.y,width:20,height:20,speed:100,blinkPhase:0})}break}}for(let t=m.length-1;t>=0;t--){const e=m[t];if(r.x<e.x+e.width&&r.x+r.width>e.x&&r.y<e.y+e.height&&r.y+r.height>e.y&&(m.splice(t,1),r.bonusCount<23)){r.bonusCount++;const t=3.3+.3*r.bonusCount;r.shootDelay=Math.max(.1,1/t),s("/audio/bonus.mp3")}}if(w.forEach((t=>{if("explosion"===t.type){const i=t.time/t.duration,h=t.radius+(t.maxRadius-t.radius)*i,a=e.createRadialGradient(t.x,t.y,0,t.x,t.y,h);a.addColorStop(0,"rgba(255, 165, 0, 1)"),a.addColorStop(1,"rgba(255, 0, 0, 0)"),e.beginPath(),e.arc(t.x,t.y,h,0,2*Math.PI),e.fillStyle=a,e.fill(),t.particles.forEach((t=>{e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI),e.fillStyle=`rgba(255, 255, 0, ${t.alpha})`,e.fill()}))}})),e.save(),e.translate(r.x+r.width/2,r.y+r.height/2),e.rotate(r.tiltAngle),i.complete?e.drawImage(i,-r.width/2,-r.height/2,r.width,r.height):(e.fillStyle="white",e.fillRect(-r.width/2,-r.height/2,r.width,r.height)),e.restore(),g.forEach((t=>{const i=e.createLinearGradient(t.x+t.width/2,t.y,t.x+t.width/2,t.y+20);i.addColorStop(0,"rgba(255, 255, 0, 0.8)"),i.addColorStop(1,"rgba(255, 255, 0, 0)"),e.fillStyle=i,e.fillRect(t.x,t.y,t.width,20),h.complete?e.drawImage(h,t.x,t.y,t.width,t.height):(e.fillStyle="yellow",e.fillRect(t.x,t.y,t.width,t.height))})),p.forEach((t=>{if(t.image.complete?e.drawImage(t.image,t.x,t.y,t.width,t.height):(e.fillStyle=t.health>1?"purple":"red",e.fillRect(t.x,t.y,t.width,t.height)),t.maxHealth>1){const i=t.width,h=5,a=t.health/t.maxHealth;e.fillStyle="red",e.fillRect(t.x,t.y-10,i,h),e.fillStyle="green",e.fillRect(t.x,t.y-10,i*a,h)}})),m.forEach((t=>{const i=(Math.sin(t.blinkPhase)+1)/2,h=e.createRadialGradient(t.x+t.width/2,t.y+t.height/2,0,t.x+t.width/2,t.y+t.height/2,t.width/2);h.addColorStop(0,`rgba(0, 255, 0, ${.8+.2*i})`),h.addColorStop(1,`rgba(0, 0, 255, ${.8+.2*i})`),e.fillStyle=h,n.complete?e.drawImage(n,t.x,t.y,t.width,t.height):e.fillRect(t.x,t.y,t.width,t.height)})),e.fillStyle="white",e.font="20px Arial",e.textAlign="left",e.fillText(`Score: ${y}`,10,30),e.fillText(`Wave: ${c} (Need: ${x})`,10,60),e.fillText(`Fire Rate: ${(1/r.shootDelay).toFixed(1)}/s`,10,90),v){const i=v.time/v.duration;e.globalAlpha=Math.sin(i*Math.PI),e.fillStyle="white",e.font="40px Arial",e.textAlign="center",e.fillText(`Wave ${v.wave} begins!`,t.width/2,t.height/3),e.globalAlpha=1}requestAnimationFrame($)}Promise.all([new Promise((t=>i.onload=t)),new Promise((t=>h.onload=t)),new Promise((t=>a.onload=t)),new Promise((t=>l.onload=t)),new Promise((t=>o.onload=t)),new Promise((t=>n.onload=t)),new Promise((t=>d.onload=t)),new Promise((t=>{new Audio("/audio/shoot.mp3").oncanplaythrough=t})),new Promise((t=>{new Audio("/audio/explosion.mp3").oncanplaythrough=t})),new Promise((t=>{new Audio("/audio/bonus.mp3").oncanplaythrough=t})),new Promise((t=>{new Audio("/audio/gameover.mp3").oncanplaythrough=t})),new Promise((t=>{new Audio("/audio/wave.mp3").oncanplaythrough=t}))]).then((()=>{requestAnimationFrame($)}))})();