(()=>{"use strict";var e,t,r={4:(e,t,r)=>{var o=r(5072),a=r.n(o),n=r(7825),d=r.n(n),i=r(7659),s=r.n(i),l=r(5056),c=r.n(l),m=r(540),u=r.n(m),p=r(1113),h=r.n(p),y=r(2378),g={};g.styleTagTransform=h(),g.setAttributes=c(),g.insert=s().bind(null,"head"),g.domAPI=d(),g.insertStyleElement=u(),a()(y.A,g),y.A&&y.A.locals&&y.A.locals;var w=r(7541),f={};f.styleTagTransform=h(),f.setAttributes=c(),f.insert=s().bind(null,"head"),f.domAPI=d(),f.insertStyleElement=u(),a()(w.A,f),w.A&&w.A.locals&&w.A.locals;const v=document.getElementById("gameCanvas"),b=v.getContext("2d"),E=document.getElementById("connectWalletScreen"),k=document.getElementById("connectWalletButton"),x=document.getElementById("startScreen"),S=document.getElementById("startButton"),I=document.getElementById("leaderboardButton"),T=document.getElementById("gameOver"),M=document.getElementById("scoreDisplay"),A=document.getElementById("restartButton"),B=document.getElementById("submitScoreButton"),C=document.getElementById("gameOverLeaderboardButton"),Y=document.getElementById("leaderboardModal"),L=document.getElementById("leaderboardBody"),O=document.getElementById("closeLeaderboardButton"),P=document.getElementById("myRecordButton"),F=document.getElementById("gameOverMyRecordButton"),N=v.height/2,j={doodler:{x:v.width/2-25,y:v.height-100,width:35,height:50,velocityY:0,velocityX:0,jumpStrength:-15,gravity:.5,facingRight:!0},platforms:[],cameraY:0,score:0,speedMultiplier:1,gameOver:!1,gameStarted:!1,lastTime:performance.now(),isConnected:!1,walletAddress:""};function R(){if(b.clearRect(0,0,v.width,v.height),me.background.complete&&j.gameStarted){const e=me.background.height,t=-j.cameraY%e;b.drawImage(me.background,0,t,v.width,e),t>-e&&b.drawImage(me.background,0,t-e,v.width,e)}if(!j.gameStarted)return;j.platforms.forEach(e=>{if(!e.broken){let t;switch(e.type){case"normal":t=me.platform;break;case"moving":t=me.movingPlatform;break;case"breakable":t=me.breakablePlatform;break;case"spring":t=me.springPlatform}b.drawImage(t,e.x,e.y-j.cameraY,e.width,e.height)}}),b.save();const e=j.doodler.width/2;j.doodler.x<-e?j.doodler.x+=v.width:j.doodler.x+j.doodler.width>v.width+e&&(j.doodler.x-=v.width),j.doodler.facingRight?(b.drawImage(me.doodler,j.doodler.x,j.doodler.y-j.cameraY,j.doodler.width,j.doodler.height),j.doodler.x<0?(b.restore(),b.save(),b.drawImage(me.doodler,j.doodler.x+v.width,j.doodler.y-j.cameraY,j.doodler.width,j.doodler.height)):j.doodler.x+j.doodler.width>v.width&&(b.restore(),b.save(),b.drawImage(me.doodler,j.doodler.x-v.width,j.doodler.y-j.cameraY,j.doodler.width,j.doodler.height))):(b.translate(j.doodler.x+j.doodler.width,0),b.scale(-1,1),b.drawImage(me.doodler,0,j.doodler.y-j.cameraY,j.doodler.width,j.doodler.height),j.doodler.x<0?(b.restore(),b.save(),b.translate(j.doodler.x+j.doodler.width+v.width,0),b.scale(-1,1),b.drawImage(me.doodler,0,j.doodler.y-j.cameraY,j.doodler.width,j.doodler.height)):j.doodler.x+j.doodler.width>v.width&&(b.restore(),b.save(),b.translate(j.doodler.x+j.doodler.width-v.width,0),b.scale(-1,1),b.drawImage(me.doodler,0,j.doodler.y-j.cameraY,j.doodler.width,j.doodler.height))),b.restore(),b.fillStyle="black",b.font="20px Arial",b.fillText(`Score: ${j.score}`,10,20)}function X(){const e=Math.random();return e<.5?"normal":e<.7?"moving":e<.9?"breakable":"spring"}function $(){j.doodler.x=v.width/2-25,j.doodler.y=v.height-100,j.doodler.velocityY=0,j.doodler.velocityX=0,j.doodler.facingRight=!0,j.cameraY=0,j.score=0,j.speedMultiplier=1,j.gameOver=!1,j.gameStarted=!0,T.style.display="none",function(){j.platforms.length=0,j.platforms.push({x:160,y:v.height-50,width:80,height:20,type:"normal"});for(let e=1;e<6;e++){const t=j.platforms[e-1],r=Math.random()*(v.width-80),o=t.y-(50+100*Math.random()),a=X();j.platforms.push({x:r,y:o,width:80,height:20,type:a,velocityX:"moving"===a?2*j.speedMultiplier:0,broken:!1})}}(),j.lastTime=performance.now(),_(performance.now())}function _(e){if(!j.gameOver&&j.gameStarted){const t=(e-j.lastTime)/1e3;j.lastTime=e,function(e){j.speedMultiplier=Math.min(1+Math.abs(j.score)/1e4,2),j.doodler.velocityY+=j.doodler.gravity*j.speedMultiplier*e*60,j.doodler.y+=j.doodler.velocityY*e*60,j.doodler.x+=j.doodler.velocityX*e*60;const t=j.doodler.y-j.cameraY;if(Math.abs(t-N)>10){const t=j.doodler.y-N;j.cameraY+=.1*(t-j.cameraY)*e*60}j.score=-1*Math.floor(j.cameraY/10),j.platforms.forEach(t=>{"moving"===t.type&&(t.x+=t.velocityX*e*60,t.velocityX=2*(t.velocityX>=0?1:-1)*j.speedMultiplier,(t.x<0||t.x+t.width>v.width)&&(t.velocityX=-t.velocityX))});let r=[];j.platforms.forEach((e,t)=>{j.doodler.x<e.x+e.width&&j.doodler.x+j.doodler.width>e.x&&j.doodler.y+j.doodler.height>e.y&&j.doodler.y+j.doodler.height<e.y+e.height&&j.doodler.velocityY>0&&!e.broken&&("spring"===e.type?j.doodler.velocityY=1.5*j.doodler.jumpStrength*j.speedMultiplier:j.doodler.velocityY=j.doodler.jumpStrength*j.speedMultiplier,"breakable"===e.type&&(e.broken=!0,r.push(t)))}),j.platforms=j.platforms.filter((e,t)=>!r.includes(t));const o=j.platforms.reduce((e,t)=>t.y<e.y?t:e,j.platforms[0]);if(o.y>j.cameraY-150){const e=Math.random()*(v.width-80),t=o.y-(50+100*Math.random()),r=X();j.platforms.push({x:e,y:t,width:80,height:20,type:r,velocityX:"moving"===r?2*j.speedMultiplier:0,broken:!1}),j.platforms=j.platforms.filter(e=>e.y<j.cameraY+v.height+100)}j.doodler.y>j.cameraY+v.height&&(j.gameOver=!0,j.gameStarted=!1,T.style.display="block",M.textContent=`Score: ${j.score}`)}(t),R(),requestAnimationFrame(_)}}var U=r(4676),q=r(3197),D=r(5387),W=r(9873),z=r(8946),H=r(2427);const J=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"player",type:"address"},{indexed:!1,internalType:"uint256",name:"score",type:"uint256"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"ScoreRegistered",type:"event"},{inputs:[],name:"getAllScores",outputs:[{components:[{internalType:"address",name:"player",type:"address"},{internalType:"uint256",name:"score",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],internalType:"struct SomniaJump.Score[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getPlayerCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_player",type:"address"}],name:"getScore",outputs:[{components:[{internalType:"address",name:"player",type:"address"},{internalType:"uint256",name:"score",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],internalType:"struct SomniaJump.Score",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"players",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_score",type:"uint256"}],name:"registerScore",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"scores",outputs:[{internalType:"address",name:"player",type:"address"},{internalType:"uint256",name:"score",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"}],G=(0,U.x)({id:50312,name:"Somnia Testnet",nativeCurrency:{decimals:18,name:"Ether",symbol:"STT"},rpcUrls:{default:{http:["https://dream-rpc.somnia.network"]}},blockExplorers:{default:{name:"Explorer",url:"shannon-explorer.somnia.network"}}}),K="0xB828843Bbf31AC871C31386DA821F1E945C14072";async function Q(){if(!j.isConnected)throw new Error("Wallet not connected");try{const e=(0,z.l)({chain:G,transport:(0,H.L)(G.rpcUrls.default.http[0])}),t=(await e.readContract({address:K,abi:J,functionName:"getAllScores"})).sort((e,t)=>Number(t.score)-Number(e.score));L.innerHTML="",t.forEach((e,t)=>{const r=document.createElement("tr");r.innerHTML=`\n        <td>${t+1}</td>\n        <td>${e.player.slice(0,6)}...${e.player.slice(-4)}</td>\n        <td>${e.score}</td>\n        <td>${new Date(1e3*Number(e.timestamp)).toLocaleString()}</td>\n      `,L.appendChild(r)})}catch(e){throw console.error("Failed to fetch leaderboard:",e),new Error("Failed to fetch leaderboard: "+e.message)}}async function V(e){if(!j.isConnected)throw new Error("Wallet not connected");if(!(0,W.P)(e))throw new Error("Invalid address");try{const t=(0,z.l)({chain:G,transport:(0,H.L)(G.rpcUrls.default.http[0])});return await t.readContract({address:K,abi:J,functionName:"getScore",args:[e]})}catch(e){throw console.error("Failed to fetch player score:",e),new Error("Failed to fetch player score: "+e.message)}}const Z=r.p+"assets/doodler.png",ee=r.p+"assets/platform.png",te=r.p+"assets/moving_platform.png",re=r.p+"assets/breakable_platform.png",oe=r.p+"assets/spring_platform.png",ae=r.p+"assets/background.png",ne=new Image;ne.src=Z;const de=new Image;de.src=ee;const ie=new Image;ie.src=te;const se=new Image;se.src=re;const le=new Image;le.src=oe;const ce=new Image;ce.src=ae;const me={doodler:ne,platform:de,movingPlatform:ie,breakablePlatform:se,springPlatform:le,background:ce};!function(e){let t=0;const r=Object.keys(me).length;for(const o of Object.values(me))o.complete?(t++,t===r&&e()):o.onload=()=>{t++,t===r&&e()}}(function(){E.style.display="block",R(),document.addEventListener("keydown",e=>{j.gameStarted&&("ArrowLeft"===e.code&&(j.doodler.velocityX=-5,j.doodler.facingRight=!1),"ArrowRight"===e.code&&(j.doodler.velocityX=5,j.doodler.facingRight=!0))}),document.addEventListener("keyup",e=>{j.gameStarted&&("ArrowLeft"!==e.code&&"ArrowRight"!==e.code||(j.doodler.velocityX=0))}),k.addEventListener("click",async()=>{try{await async function(){if("undefined"==typeof window||!window.ethereum)throw console.error("MetaMask is not installed!"),alert("Please install MetaMask to play the game."),new Error("MetaMask not installed");try{await window.ethereum.request({method:"eth_requestAccounts"});const e=(0,q.F)({chain:G,transport:(0,D.I)(window.ethereum)}),[t]=await e.getAddresses();if(!(0,W.P)(t))throw new Error("Invalid wallet address");j.walletAddress=t,j.isConnected=!0,console.log("Connected account:",t);const r=await window.ethereum.request({method:"eth_chainId"});if(parseInt(r,16)!==G.id)try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${G.id.toString(16)}`}]})}catch(e){if(4902!==e.code)throw e;await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${G.id.toString(16)}`,chainName:G.name,rpcUrls:G.rpcUrls.default.http,nativeCurrency:G.nativeCurrency,blockExplorerUrls:[G.blockExplorers.default.url]}]})}}catch(e){throw console.error("User denied account access:",e),e}}(),j.isConnected&&(E.style.display="none",x.style.display="block")}catch(e){console.error("Failed to connect MetaMask:",e),alert("Failed to connect MetaMask. Please try again.")}}),S.addEventListener("click",()=>{x.style.display="none",j.gameStarted=!0,$()}),I.addEventListener("click",async()=>{await Q(),Y.style.display="flex"}),A.addEventListener("click",()=>{T.style.display="none",j.gameStarted=!0,$()}),B.addEventListener("click",async()=>{try{await async function(e){if(!j.isConnected||!j.walletAddress)throw new Error("Wallet not connected");if(!(0,W.P)(j.walletAddress))throw new Error("Invalid wallet address");if(e<=0)throw new Error("Score must be greater than zero");try{const t=(0,q.F)({chain:G,transport:(0,D.I)(window.ethereum)}),r=(0,z.l)({chain:G,transport:(0,H.L)(G.rpcUrls.default.http[0])}),o=await t.writeContract({address:K,abi:J,functionName:"registerScore",args:[BigInt(e)],account:j.walletAddress});let a;console.log("Transaction sent, hash:",o);try{a=await r.waitForTransactionReceipt({hash:o,timeout:12e4}),console.log("Score submitted, tx hash:",o)}catch(t){console.warn("Transaction confirmation timed out, checking contract state...");const a=await r.readContract({address:K,abi:J,functionName:"getScore",args:[j.walletAddress]});if(Number(a.score)===e)return console.log("Score verified in contract, tx likely successful:",o),{transactionHash:o,status:"success"};throw new Error("Score not updated in contract, transaction may have failed")}return a}catch(e){if(console.error("Failed to submit score:",e),e.message.includes("New score must be higher"))throw new Error("New score must be higher than your previous score");if(e.message.includes("Score must be greater than zero"))throw new Error("Score must be greater than zero");if(e.message.includes("IntegerOutOfRangeError"))throw new Error("Invalid score value");throw new Error("Failed to submit score: "+e.message)}}(j.score),alert("Score submitted successfully!")}catch(e){console.error("Failed to submit score:",e),alert("Failed to submit score. Please try again.")}}),P.addEventListener("click",async()=>{try{const e=await V(j.walletAddress),t=e.score.toString(),r=new Date(1e3*Number(e.timestamp)).toLocaleString();alert(`Your best score: ${t}\nDate: ${r}`)}catch(e){console.error("Failed to fetch your score:",e),alert("Failed to fetch your score. Please try again.")}}),F.addEventListener("click",async()=>{try{const e=await V(j.walletAddress),t=e.score.toString(),r=new Date(1e3*Number(e.timestamp)).toLocaleString();alert(`Your best score: ${t}\nDate: ${r}`)}catch(e){console.error("Failed to fetch your score:",e),alert("Failed to fetch your score. Please try again.")}}),C.addEventListener("click",async()=>{await Q(),Y.style.display="flex"}),O.addEventListener("click",()=>{Y.style.display="none"})})},2378:(e,t,r)=>{r.d(t,{A:()=>i});var o=r(1601),a=r.n(o),n=r(6314),d=r.n(n)()(a());d.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const i=d},7541:(e,t,r)=>{r.d(t,{A:()=>i});var o=r(1601),a=r.n(o),n=r(6314),d=r.n(n)()(a());d.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const i=d}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={id:e,exports:{}};return r[e](n,n.exports,a),n.exports}a.m=r,e=[],a.O=(t,r,o,n)=>{if(!r){var d=1/0;for(c=0;c<e.length;c++){for(var[r,o,n]=e[c],i=!0,s=0;s<r.length;s++)(!1&n||d>=n)&&Object.keys(a.O).every(e=>a.O[e](r[s]))?r.splice(s--,1):(i=!1,n<d&&(d=n));if(i){e.splice(c--,1);var l=o();void 0!==l&&(t=l)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[r,o,n]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,r)=>(a.f[r](e,t),t),[])),a.u=e=>"js/"+e+".e78e47de2664a92947fe.js",a.miniCssF=e=>{},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},a.l=(e,r,o,n)=>{if(t[e])t[e].push(r);else{var d,i;if(void 0!==o)for(var s=document.getElementsByTagName("script"),l=0;l<s.length;l++){var c=s[l];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==" :"+o){d=c;break}}d||(i=!0,(d=document.createElement("script")).charset="utf-8",d.timeout=120,a.nc&&d.setAttribute("nonce",a.nc),d.setAttribute("data-webpack"," :"+o),d.src=e),t[e]=[r];var m=(r,o)=>{d.onerror=d.onload=null,clearTimeout(u);var a=t[e];if(delete t[e],d.parentNode&&d.parentNode.removeChild(d),a&&a.forEach(e=>e(o)),r)return r(o)},u=setTimeout(m.bind(null,void 0,{type:"timeout",target:d}),12e4);d.onerror=m.bind(null,d.onerror),d.onload=m.bind(null,d.onload),i&&document.head.appendChild(d)}},a.p="/test-vlad/",(()=>{var e={524:0};a.f.j=(t,r)=>{var o=a.o(e,t)?e[t]:void 0;if(0!==o)if(o)r.push(o[2]);else{var n=new Promise((r,a)=>o=e[t]=[r,a]);r.push(o[2]=n);var d=a.p+a.u(t),i=new Error;a.l(d,r=>{if(a.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var n=r&&("load"===r.type?"missing":r.type),d=r&&r.target&&r.target.src;i.message="Loading chunk "+t+" failed.\n("+n+": "+d+")",i.name="ChunkLoadError",i.type=n,i.request=d,o[1](i)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,r)=>{var o,n,[d,i,s]=r,l=0;if(d.some(t=>0!==e[t])){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(s)var c=s(a)}for(t&&t(r);l<d.length;l++)n=d[l],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},r=self.webpackChunk_=self.webpackChunk_||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),a.nc=void 0;var n=a.O(void 0,[591],()=>a(4));n=a.O(n)})();